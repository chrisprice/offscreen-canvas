(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-scale"),require("d3-selection"),require("@d3fc/d3fc-data-join"),require("@d3fc/d3fc-shape"),require("@d3fc/d3fc-rebind"),require("@d3fc/d3fc-series"),require("d3-shape")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-selection","@d3fc/d3fc-data-join","@d3fc/d3fc-shape","@d3fc/d3fc-rebind","@d3fc/d3fc-series","d3-shape"],b):(a=a||self,b(a.fc=a.fc||{},a.d3,a.d3,a.fc,a.fc,a.fc,a.fc,a.d3))})(this,function(a,b,c,d,e,f,g,h){'use strict';function i(a){return j(a)||k(a)||l()}function j(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function k(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var m=function(a){return"function"==typeof a?a:function(){return a}},n=function(){var a=b.scaleIdentity(),e=b.scaleIdentity(),f=function(a){return a},h=f,i=function(){},j="horizontal",k=d.dataJoin("g","annotation-line"),l=function(b){if(b.selection&&k.transition(b),"horizontal"!==j&&"vertical"!==j)throw new Error("Invalid orientation");var d="horizontal"===j,l=d?function(c,a){return"translate(".concat(c,", ").concat(a,")")}:function(c,a){return"translate(".concat(a,", ").concat(c,")")},m=d?"x2":"y2",n=d?a:e,o=d?e:a,p=d?"left-handle":"bottom-handle",q=d?"right-handle":"top-handle",r=d?"9":"0",s=d?"0":"9",t=d?"0.32em":"0.71em",u=d?"start":"middle",v=n.range(),w=function(){return l(v[0],o(f.apply(void 0,arguments)))},x=v[1]-v[0];b.each(function(a,b,d){var e=k(c.select(d[b]),a),f=e.enter().attr("transform",w).style("stroke","#bbb");f.append("line").attr(m,x),f.append("g").classed(p,!0).style("stroke","none"),f.append("g").classed(q,!0).style("stroke","none").attr("transform",l(x,0)).append("text").attr("text-anchor",u).attr("x",r).attr("y",s).attr("dy",t),e.attr("class","annotation-line ".concat(j)),e.attr("transform",w),e.select("line").attr(m,x),e.select("g."+q).attr("transform",l(x,0)),e.select("text").text(h),i(e,a,b)})};return l.xScale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],l):a},l.yScale=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],l):e},l.value=function(){return arguments.length?(f=m(0>=arguments.length?void 0:arguments[0]),l):f},l.label=function(){return arguments.length?(h=m(0>=arguments.length?void 0:arguments[0]),l):h},l.decorate=function(){return arguments.length?(i=0>=arguments.length?void 0:arguments[0],l):i},l.orient=function(){return arguments.length?(j=0>=arguments.length?void 0:arguments[0],l):j},l},o=function(){var a=b.scaleIdentity(),c=b.scaleIdentity(),e=function(a){return a},g=e,j=function(){},k="horizontal",l=h.line(),n=function(b){if("horizontal"!==k&&"vertical"!==k)throw new Error("Invalid orientation");var f="horizontal"===k,h=l.context(),m=f?a:c,n=f?c:a,o=m.domain(),p=f?9:0,q=f?0:9,r=f?"left":"center",s=f?"middle":"hanging";b.forEach(function(a,b){h.save(),h.beginPath(),h.strokeStyle="#bbb",h.fillStyle="#000",h.textAlign=r,h.textBaseline=s,j(h,a,b),l.context(h)(o.map(function(b){var c=[m(b),n(e(a))];return f?c:c.reverse()}));var c=f?m(o[1]):n(e(a)),d=f?n(e(a)):m(o[1]);h.fillText(g(a),c+p,d+q),h.fill(),h.stroke(),h.closePath(),h.restore()})};return n.xScale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],n):a},n.yScale=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],n):c},n.value=function(){return arguments.length?(e=m(0>=arguments.length?void 0:arguments[0]),n):e},n.label=function(){return arguments.length?(g=m(0>=arguments.length?void 0:arguments[0]),n):g},n.decorate=function(){return arguments.length?(j=0>=arguments.length?void 0:arguments[0],n):j},n.orient=function(){return arguments.length?(k=0>=arguments.length?void 0:arguments[0],n):k},f.rebind(n,l,"context"),n},p=function(){var a=b.scaleIdentity(),c=[10],d=null,e=function(){var b;return null==d?a.ticks?(b=a).ticks.apply(b,i(c)):a.domain():d};return e.scale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],e):a},e.ticks=function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return c=b,e},e.tickArguments=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],e):c},e.tickValues=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],e):d},e},q=function(a){return a};a.annotationCanvasBand=function(){var a=b.scaleIdentity(),c=b.scaleIdentity(),d="horizontal",g=function(a){return a.from},h=function(a){return a.to},j=function(){},k=e.shapeBar().horizontalAlign("right").verticalAlign("top"),l=function(b){if("horizontal"!==d&&"vertical"!==d)throw new Error("Invalid orientation");var e=k.context(),f="horizontal"===d,i=f?a:c,l=f?c:a,m=i.range(),n=m[1]-m[0],o=f?"x":"y",p=f?"y":"x",q=f?"height":"width",r=f?"width":"height";b.forEach(function(a,b){e.save(),e.beginPath(),e.strokeStyle="transparent",k[p](l(g(a))),k[o](m[0]),k[r](n),k[q](l(h(a))-l(g(a))),j(e,a,b),k.context(e)([a],b),e.fill(),e.stroke(),e.closePath(),e.restore()})};return l.xScale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],l):a},l.yScale=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],l):c},l.orient=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],l):d},l.decorate=function(){return arguments.length?(j=0>=arguments.length?void 0:arguments[0],l):j},l.fromValue=function(){return arguments.length?(g=m(0>=arguments.length?void 0:arguments[0]),l):g},l.toValue=function(){return arguments.length?(h=m(0>=arguments.length?void 0:arguments[0]),l):h},f.rebind(l,k,"context"),l},a.annotationCanvasCrosshair=function(){var a=function(a){return a.x},c=function(a){return a.y},e=b.scaleIdentity(),h=b.scaleIdentity(),i=g.seriesCanvasPoint(),j=o(),k=o().orient("vertical"),l=b.scaleIdentity(),m=b.scaleIdentity(),n=g.seriesCanvasMulti().series([j,k,i]).xScale(l).yScale(m).mapping(function(a){return[a]}),p=function(b){b.forEach(function(b){l.range(e.range()),m.range(h.range()),i.crossValue(a).mainValue(c),j.value(c),k.value(a),n(b)})};p.x=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],p):a},p.y=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],p):c},p.xScale=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],p):e},p.yScale=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],p):h};var q=f.include("label","decorate");return f.rebindAll(p,j,q,f.prefix("y")),f.rebindAll(p,k,q,f.prefix("x")),f.rebind(p,i,"decorate"),f.rebind(p,n,"context"),p},a.annotationCanvasGridline=function(){var a=function(){},b=function(){},c=p(),d=p(),e=h.line(),g=function(){var f=e.context(),g=c.scale(),h=d.scale();c().forEach(function(b,c){f.save(),f.beginPath(),f.strokeStyle="#bbb",f.fillStyle="transparent",a(f,b,c),e.context(f)(h.domain().map(function(a){return[g(b),h(a)]})),f.fill(),f.stroke(),f.closePath(),f.restore()}),d().forEach(function(a,c){f.save(),f.beginPath(),f.strokeStyle="#bbb",f.fillStyle="transparent",b(f,a,c),e.context(f)(g.domain().map(function(b){return[g(b),h(a)]})),f.fill(),f.stroke(),f.closePath(),f.restore()})};return g.yDecorate=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],g):b},g.xDecorate=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],g):a},f.rebindAll(g,c,f.prefix("x")),f.rebindAll(g,d,f.prefix("y")),f.rebind(g,e,"context"),g},a.annotationCanvasLine=o,a.annotationSvgBand=function(){var a=b.scaleIdentity(),f=b.scaleIdentity(),h="horizontal",i=function(a){return a.from},j=function(a){return a.to},k=function(){},l=d.dataJoin("g","annotation-band"),n=e.shapeBar().horizontalAlign("center").verticalAlign("center").x(0).y(0),o=function(b){if(b.selection&&l.transition(b),"horizontal"!==h&&"vertical"!==h)throw new Error("Invalid orientation");var d="horizontal"===h,e=d?function(c,a){return"translate(".concat(c,", ").concat(a,")")}:function(c,a){return"translate(".concat(a,", ").concat(c,")")},g=d?a:f,m=d?f:a,o=g.range(),p=o[1]-o[0],q=d?"height":"width",r=d?"width":"height",s=function(){return e((o[1]+o[0])/2,(m(j.apply(void 0,arguments))+m(i.apply(void 0,arguments)))/2)};n[r](p),n[q](function(){return m(j.apply(void 0,arguments))-m(i.apply(void 0,arguments))}),b.each(function(a,b,d){var e=l(c.select(d[b]),a);e.enter().attr("transform",s).append("path").classed("band",!0),e.attr("class","annotation-band ".concat(h)).attr("transform",s).select("path").attr("d",function(a,b){return n([a],b)}),k(e,a,b)})};return o.xScale=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],o):a},o.yScale=function(){return arguments.length?(f=0>=arguments.length?void 0:arguments[0],o):f},o.orient=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],o):h},o.decorate=function(){return arguments.length?(k=0>=arguments.length?void 0:arguments[0],o):k},o.fromValue=function(){return arguments.length?(i=m(0>=arguments.length?void 0:arguments[0]),o):i},o.toValue=function(){return arguments.length?(j=m(0>=arguments.length?void 0:arguments[0]),o):j},o},a.annotationSvgCrosshair=function(){var a=function(a){return a.x},e=function(a){return a.y},h=b.scaleIdentity(),i=b.scaleIdentity(),j=function(){},k=d.dataJoin("g","annotation-crosshair"),l=g.seriesSvgPoint(),m=n(),o=n().orient("vertical"),p=b.scaleIdentity(),q=b.scaleIdentity(),r=g.seriesSvgMulti().series([m,o,l]).xScale(p).yScale(q).mapping(function(a){return[a]}),s=function(b){b.selection&&k.transition(b),b.each(function(b,d,f){var n=k(c.select(f[d]),b);n.enter().style("pointer-events","none"),p.range(h.range()),q.range(i.range()),l.crossValue(a).mainValue(e),m.value(e),o.value(a),n.call(r),j(n,b,d)})};s.x=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],s):a},s.y=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],s):e},s.xScale=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],s):h},s.yScale=function(){return arguments.length?(i=0>=arguments.length?void 0:arguments[0],s):i},s.decorate=function(){return arguments.length?(j=0>=arguments.length?void 0:arguments[0],s):j};var t=f.include("label");return f.rebindAll(s,m,t,f.prefix("y")),f.rebindAll(s,o,t,f.prefix("x")),s},a.annotationSvgGridline=function(){var a=function(){},b=function(){},e=p(),g=p(),h=d.dataJoin("line","gridline-y").key(q),i=d.dataJoin("line","gridline-x").key(q),j=function(d){d.selection&&(h.transition(d),i.transition(d)),d.each(function(d,f,j){var k=j[f],l=c.select(j[f]),m=e.scale(),n=g.scale(),o=k.__x_scale__||m;k.__x_scale__=m.copy();var p=e(),q=h(l,p);q.enter().attr("x1",o).attr("x2",o).attr("y1",n.range()[0]).attr("y2",n.range()[1]),q.attr("x1",m).attr("x2",m).attr("y1",n.range()[0]).attr("y2",n.range()[1]).attr("stroke","#bbb"),q.exit().attr("x1",m).attr("x2",m),a(q,p,f);var r=k.__y_scale__||n;k.__y_scale__=n.copy();var s=g(),t=i(l,s);t.enter().attr("y1",r).attr("y2",r).attr("x1",m.range()[0]).attr("x2",m.range()[1]),t.attr("y1",n).attr("y2",n).attr("x1",m.range()[0]).attr("x2",m.range()[1]).attr("stroke","#bbb"),t.exit().attr("y1",n).attr("y2",n),b(t,s,f)})};return j.yDecorate=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],j):b},j.xDecorate=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],j):a},f.rebindAll(j,h,f.includeMap({key:"xKey"})),f.rebindAll(j,i,f.includeMap({key:"yKey"})),f.rebindAll(j,e,f.prefix("x")),f.rebindAll(j,g,f.prefix("y")),j},a.annotationSvgLine=n,Object.defineProperty(a,"__esModule",{value:!0})});
